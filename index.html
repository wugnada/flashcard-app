<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>í…ìŠ¤íŠ¸ ì—°ìŠµ - ì•ˆë“œë¡œì´ë“œ</title>
    
    <!-- PWA ì„¤ì • -->
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="í…ìŠ¤íŠ¸ì—°ìŠµ">
    <meta name="description" content="ì•ˆë“œë¡œì´ë“œìš© í…ìŠ¤íŠ¸ ì—°ìŠµ ì•±">
    
    <!-- ì•ˆë“œë¡œì´ë“œ ì „ìš© ì•„ì´ì½˜ -->
    <link rel="icon" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect width='192' height='192' fill='%23000'/><text x='96' y='110' text-anchor='middle' fill='%2390EE90' font-size='80'>ğŸ“</text></svg>">
    <link rel="icon" sizes="512x512" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%23000'/><text x='256' y='300' text-anchor='middle' fill='%2390EE90' font-size='200'>ğŸ“</text></svg>">
    
    <!-- ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link rel="manifest" href="manifest.json">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        body {
            font-family: 'Roboto', 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #000 0%, #111 100%);
            color: #90EE90;
            display: flex;
            flex-direction: column;
            touch-action: manipulation;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        .status-bar {
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .status-left {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .app-title {
            font-size: 1rem;
            font-weight: 700;
            color: #90EE90;
        }

        .usage-info {
            font-size: 0.75rem;
            color: #FFD700;
        }

        .status-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .typing-status {
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .typing-status.active {
            opacity: 1;
        }

        .menu-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            border: none;
            color: #90EE90;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .menu-btn:active {
            background: #555;
            transform: scale(0.9);
        }

        .editor-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .text-editor {
            width: 100%;
            height: 100%;
            background: transparent;
            color: #90EE90;
            border: none;
            outline: none;
            font-family: 'JetBrains Mono', 'Roboto Mono', monospace;
            font-size: 1.1rem;
            padding: 1rem;
            resize: none;
            line-height: 1.6;
            text-align: center;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .text-editor::placeholder {
            color: #555;
            text-align: center;
        }

        .floating-actions {
            position: fixed;
            bottom: 2rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            z-index: 200;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .fab:active {
            transform: scale(0.9);
        }

        .fab.primary {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .fab.danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .fab.secondary {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }

        .modal {
            background: linear-gradient(135deg, #111 0%, #000 100%);
            border: 2px solid #333;
            border-radius: 16px;
            padding: 1.5rem;
            width: 100%;
            max-width: 350px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.8);
            transform: scale(0.9);
            transition: transform 0.2s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            color: #90EE90;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .modal-subtitle {
            color: #FFD700;
            font-size: 0.85rem;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .settings-item {
            background: #222;
            border: 2px solid #444;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            color: #90EE90;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .settings-item:active {
            transform: scale(0.95);
        }

        .settings-item.active {
            background: #90EE90;
            color: #000;
            border-color: #90EE90;
        }

        .modal-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #444;
            border-radius: 8px;
            background: #333;
            color: #90EE90;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .modal-btn:active {
            transform: scale(0.95);
        }

        .modal-btn.primary {
            background: #90EE90;
            color: #000;
            border-color: #90EE90;
        }

        .install-prompt {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #333 0%, #222 100%);
            padding: 1rem;
            display: none;
            align-items: center;
            justify-content: space-between;
            border-top: 2px solid #444;
            z-index: 300;
        }

        .install-text {
            color: #90EE90;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .install-btn {
            background: #90EE90;
            color: #000;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
        }

        .auto-clear-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 107, 107, 0.9);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 500;
            backdrop-filter: blur(10px);
        }

        .auto-clear-indicator.show {
            opacity: 1;
        }

        /* ì•ˆë“œë¡œì´ë“œ ì „ìš© ìµœì í™” */
        @media (max-height: 600px) {
            .text-editor {
                font-size: 1rem;
                padding: 0.75rem;
            }
            
            .floating-actions {
                bottom: 1rem;
            }
        }

        /* ì§„ë™ í”¼ë“œë°± ì• ë‹ˆë©”ì´ì…˜ */
        .vibrate {
            animation: vibrate 0.3s ease-in-out;
        }

        @keyframes vibrate {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .text-editor::-webkit-scrollbar {
            width: 6px;
        }

        .text-editor::-webkit-scrollbar-track {
            background: transparent;
        }

        .text-editor::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- ìƒíƒœë°” -->
        <div class="status-bar">
            <div class="status-left">
                <div class="app-title">ğŸ“ í…ìŠ¤íŠ¸ ì—°ìŠµ</div>
                <div class="usage-info" id="usageInfo">0ì´ˆ ì‚¬ìš© ì¤‘</div>
            </div>
            <div class="status-right">
                <div class="typing-status" id="typingStatus">âŒ¨ï¸</div>
                <button class="menu-btn" onclick="showMenu()">â‹®</button>
            </div>
        </div>

        <!-- ì—ë””í„° -->
        <div class="editor-container">
            <textarea 
                class="text-editor" 
                id="textEditor" 
                placeholder="ì•ˆë“œë¡œì´ë“œì—ì„œ í…ìŠ¤íŠ¸ ì—°ìŠµì„ ì‹œì‘í•˜ì„¸ìš”...&#10;&#10;5ì´ˆê°„ íƒ€ì´í•‘ì„ ë©ˆì¶”ë©´ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤"
                spellcheck="false"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
            ></textarea>
        </div>

        <!-- í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="floating-actions">
            <button class="fab danger" onclick="clearText()" title="ì´ˆê¸°í™”">ğŸ—‘ï¸</button>
            <button class="fab secondary" onclick="copyText()" title="ë³µì‚¬">ğŸ“‹</button>
        </div>
    </div>

    <!-- ìë™ ì´ˆê¸°í™” ì•Œë¦¼ -->
    <div class="auto-clear-indicator" id="autoClearIndicator">5ì´ˆ í›„ ìë™ ì´ˆê¸°í™”</div>

    <!-- PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-text">ğŸ“± í™ˆ í™”ë©´ì— ì•±ìœ¼ë¡œ ì¶”ê°€í•˜ê¸°</div>
        <button class="install-btn" onclick="installApp()">ì¶”ê°€</button>
    </div>

    <!-- ë©”ë‰´ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="menuModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">ğŸ“‹ ë©”ë‰´</div>
            </div>
            
            <div class="settings-grid">
                <div class="settings-item" onclick="showSettings()">âš™ï¸ ì„¤ì •</div>
                <div class="settings-item" onclick="clearText(); closeMenu();">ğŸ—‘ï¸ ì´ˆê¸°í™”</div>
                <div class="settings-item" onclick="copyText(); closeMenu();">ğŸ“‹ ë³µì‚¬</div>
                <div class="settings-item" onclick="shareApp(); closeMenu();">ğŸ“¤ ê³µìœ </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn" onclick="resetStats()">í†µê³„ ì´ˆê¸°í™”</button>
                <button class="modal-btn primary" onclick="closeMenu()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">âš™ï¸ ì„¤ì •</div>
            </div>
            
            <div class="modal-subtitle">í°íŠ¸ í¬ê¸°</div>
            <div class="settings-grid">
                <div class="settings-item" onclick="setFontSize(16)">ì‘ê²Œ</div>
                <div class="settings-item" onclick="setFontSize(18)">ë³´í†µ</div>
                <div class="settings-item" onclick="setFontSize(22)">í¬ê²Œ</div>
                <div class="settings-item" onclick="setFontSize(26)">ë§¤ìš° í¬ê²Œ</div>
            </div>

            <div class="modal-subtitle">ìë™ ì´ˆê¸°í™”</div>
            <div class="settings-grid">
                <div class="settings-item" onclick="setAutoClearTime(0)">ë„ê¸°</div>
                <div class="settings-item" onclick="setAutoClearTime(3)">3ì´ˆ</div>
                <div class="settings-item" onclick="setAutoClearTime(5)">5ì´ˆ</div>
                <div class="settings-item" onclick="setAutoClearTime(10)">10ì´ˆ</div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn" onclick="closeSettings()">ì·¨ì†Œ</button>
                <button class="modal-btn primary" onclick="closeSettings()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // PWA ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì„±ê³µ'))
                .catch(err => console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨'));
        }

        // ì•± ì„¤ì •
        let appSettings = {
            fontSize: 18,
            autoClearTime: 5,
            totalUsageTime: 0,
            currentSessionTime: 0,
            lastActiveDate: new Date().toDateString()
        };

        let isTyping = false;
        let lastKeyTime = 0;
        let sessionTimer = null;
        let autoClearTimer = null;
        let deferredPrompt = null;

        // DOM ìš”ì†Œ
        const textEditor = document.getElementById('textEditor');
        const usageInfo = document.getElementById('usageInfo');
        const typingStatus = document.getElementById('typingStatus');
        const autoClearIndicator = document.getElementById('autoClearIndicator');
        const installPrompt = document.getElementById('installPrompt');

        // ì•± ì´ˆê¸°í™”
        function initApp() {
            loadSettings();
            updateUI();
            bindEvents();
            startSessionTimer();
            
            // PWA ì„¤ì¹˜ í”„ë¡¬í”„íŠ¸ ì²˜ë¦¬
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallPrompt();
            });

            // ì•ˆë“œë¡œì´ë“œ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì²˜ë¦¬
            window.addEventListener('popstate', handleBackButton);
            
            setTimeout(() => textEditor.focus(), 100);
        }

        // ì„¤ì • ë¡œë“œ
        function loadSettings() {
            try {
                const saved = localStorage.getItem('androidTextEditorSettings');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    appSettings = { ...appSettings, ...parsed };
                }
                
                // ìƒˆë¡œìš´ ë‚ ì´ë©´ ì„¸ì…˜ ì‹œê°„ ì´ˆê¸°í™”
                const today = new Date().toDateString();
                if (appSettings.lastActiveDate !== today) {
                    appSettings.currentSessionTime = 0;
                    appSettings.lastActiveDate = today;
                    saveSettings();
                }
            } catch (e) {
                console.log('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨');
            }
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            try {
                localStorage.setItem('androidTextEditorSettings', JSON.stringify(appSettings));
            } catch (e) {
                console.log('ì„¤ì • ì €ì¥ ì‹¤íŒ¨');
            }
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            textEditor.style.fontSize = appSettings.fontSize + 'px';
            updateUsageDisplay();
            updateAutoClearPlaceholder();
        }

        // ì‚¬ìš© ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateUsageDisplay() {
            const totalTime = appSettings.totalUsageTime + appSettings.currentSessionTime;
            usageInfo.textContent = `${formatTime(totalTime)} ì‚¬ìš© ì¤‘`;
            typingStatus.classList.toggle('active', isTyping);
        }

        // ìë™ ì´ˆê¸°í™” í”Œë ˆì´ìŠ¤í™€ë” ì—…ë°ì´íŠ¸
        function updateAutoClearPlaceholder() {
            const baseText = "ì•ˆë“œë¡œì´ë“œì—ì„œ í…ìŠ¤íŠ¸ ì—°ìŠµì„ ì‹œì‘í•˜ì„¸ìš”...";
            if (appSettings.autoClearTime > 0) {
                textEditor.placeholder = `${baseText}\n\n${appSettings.autoClearTime}ì´ˆê°„ íƒ€ì´í•‘ì„ ë©ˆì¶”ë©´ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤`;
            } else {
                textEditor.placeholder = baseText + "\n\nìë™ ì´ˆê¸°í™”ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤";
            }
        }

        // ì‹œê°„ í¬ë§·íŒ…
        function formatTime(seconds) {
            if (seconds < 60) return `${seconds}ì´ˆ`;
            if (seconds < 3600) {
                const min = Math.floor(seconds / 60);
                const sec = seconds % 60;
                return sec === 0 ? `${min}ë¶„` : `${min}ë¶„ ${sec}ì´ˆ`;
            }
            const hour = Math.floor(seconds / 3600);
            const min = Math.floor((seconds % 3600) / 60);
            return min === 0 ? `${hour}ì‹œê°„` : `${hour}ì‹œê°„ ${min}ë¶„`;
        }

        // ì´ë²¤íŠ¸ ë°”ì¸ë”©
        function bindEvents() {
            textEditor.addEventListener('input', onTextInput);
            textEditor.addEventListener('focus', onEditorFocus);
            textEditor.addEventListener('blur', onEditorBlur);
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('show');
                        setTimeout(() => modal.style.display = 'none', 200);
                    }
                });
            });
        }

        // í…ìŠ¤íŠ¸ ì…ë ¥ ì²˜ë¦¬
        function onTextInput() {
            startTyping();
            resetAutoClearTimer();
        }

        // ì—ë””í„° í¬ì»¤ìŠ¤
        function onEditorFocus() {
            resetAutoClearTimer();
        }

        // ì—ë””í„° í¬ì»¤ìŠ¤ ìƒìŒ
        function onEditorBlur() {
            stopTyping();
            startAutoClearTimer();
        }

        // íƒ€ì´í•‘ ì‹œì‘
        function startTyping() {
            if (!isTyping) {
                isTyping = true;
                updateUsageDisplay();
                hapticFeedback(10); // ê°€ë²¼ìš´ ì§„ë™
            }
            lastKeyTime = Date.now();
        }

        // íƒ€ì´í•‘ ì¤‘ë‹¨
        function stopTyping() {
            if (isTyping) {
                isTyping = false;
                updateUsageDisplay();
                startAutoClearTimer();
            }
        }

        // ìë™ ì´ˆê¸°í™” íƒ€ì´ë¨¸ ì‹œì‘
        function startAutoClearTimer() {
            if (appSettings.autoClearTime > 0 && textEditor.value.trim()) {
                autoClearTimer = setTimeout(() => {
                    clearText();
                    showAutoClearIndicator();
                }, appSettings.autoClearTime * 1000);
            }
        }

        // ìë™ ì´ˆê¸°í™” íƒ€ì´ë¨¸ ë¦¬ì…‹
        function resetAutoClearTimer() {
            if (autoClearTimer) {
                clearTimeout(autoClearTimer);
                autoClearTimer = null;
            }
        }

        // ìë™ ì´ˆê¸°í™” ì•Œë¦¼ í‘œì‹œ
        function showAutoClearIndicator() {
            autoClearIndicator.textContent = `${appSettings.autoClearTime}ì´ˆ í›„ ìë™ ì´ˆê¸°í™”ë¨`;
            autoClearIndicator.classList.add('show');
            setTimeout(() => autoClearIndicator.classList.remove('show'), 2000);
        }

        // ì„¸ì…˜ íƒ€ì´ë¨¸
        function startSessionTimer() {
            sessionTimer = setInterval(() => {
                if (isTyping) {
                    appSettings.currentSessionTime++;
                    updateUsageDisplay();
                    saveSettings();
                }

                // 1ì´ˆ ì´ìƒ ì…ë ¥ì´ ì—†ìœ¼ë©´ íƒ€ì´í•‘ ìƒíƒœ í•´ì œ
                if (isTyping && Date.now() - lastKeyTime > 1000) {
                    stopTyping();
                }
            }, 1000);
        }

        // í–…í‹± í”¼ë“œë°±
        function hapticFeedback(duration = 50) {
            if (navigator.vibrate) {
                navigator.vibrate(duration);
            }
        }

        // í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        function clearText() {
            textEditor.value = '';
            textEditor.focus();
            stopTyping();
            resetAutoClearTimer();
            hapticFeedback(100);
            
            // ì‹œê°ì  í”¼ë“œë°±
            textEditor.classList.add('vibrate');
            setTimeout(() => textEditor.classList.remove('vibrate'), 300);
        }

        // í…ìŠ¤íŠ¸ ë³µì‚¬
        async function copyText() {
            if (!textEditor.value.trim()) {
                hapticFeedback([50, 50, 50]); // ì—ëŸ¬ ì§„ë™
                return;
            }
            
            try {
                await navigator.clipboard.writeText(textEditor.value);
                hapticFeedback(50);
                
                // ì„±ê³µ í”¼ë“œë°±
                const fab = document.querySelector('.fab.secondary');
                fab.style.background = 'linear-gradient(135deg, #4CAF50 0%, #45a049 100%)';
                setTimeout(() => {
                    fab.style.background = 'linear-gradient(135deg, #2196F3 0%, #1976D2 100%)';
                }, 500);
            } catch (e) {
                hapticFeedback([50, 50, 50]);
            }
        }

        // ì•± ê³µìœ 
        async function shareApp() {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'í…ìŠ¤íŠ¸ ì—°ìŠµ ì•±',
                        text: 'ì•ˆë“œë¡œì´ë“œìš© í…ìŠ¤íŠ¸ ì—°ìŠµ ì•±ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”!',
                        url: window.location.href
                    });
                } catch (e) {
                    console.log('ê³µìœ  ì‹¤íŒ¨');
                }
            } else {
                // ê³µìœ  APIê°€ ì—†ìœ¼ë©´ URL ë³µì‚¬
                try {
                    await navigator.clipboard.writeText(window.location.href);
                    hapticFeedback(50);
                } catch (e) {
                    console.log('URL ë³µì‚¬ ì‹¤íŒ¨');
                }
            }
        }

        // ì„¤ì • í•¨ìˆ˜ë“¤
        function setFontSize(size) {
            appSettings.fontSize = size;
            updateUI();
            saveSettings();
            hapticFeedback(30);
        }

        function setAutoClearTime(seconds) {
            appSettings.autoClearTime = seconds;
            updateUI();
            saveSettings();
            resetAutoClearTimer();
            hapticFeedback(30);
        }

        function resetStats() {
            appSettings.totalUsageTime = 0;
            appSettings.currentSessionTime = 0;
            updateUsageDisplay();
            saveSettings();
            hapticFeedback(100);
            closeMenu();
        }

        // ëª¨ë‹¬ ê´€ë¦¬
        function showMenu() {
            document.getElementById('menuModal').style.display = 'flex';
            setTimeout(() => document.getElementById('menuModal').classList.add('show'), 10);
        }

        function closeMenu() {
            const modal = document.getElementById('menuModal');
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 200);
        }

        function showSettings() {
            closeMenu();
            setTimeout(() => {
                document.getElementById('settingsModal').style.display = 'flex';
                setTimeout(() => document.getElementById('settingsModal').classList.add('show'), 10);
            }, 200);
        }

        function closeSettings() {
            const modal = document.getElementById('settingsModal');
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = 'none', 200);
        }

        // PWA ì„¤ì¹˜
        function showInstallPrompt() {
            setTimeout(() => {
                installPrompt.style.display = 'flex';
            }, 3000); // 3ì´ˆ í›„ í‘œì‹œ
        }

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installPrompt.style.display = 'none';
                }
                deferredPrompt = null;
            }
        }

        // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì²˜ë¦¬
        function handleBackButton(e) {
            const activeModal = document.querySelector('.modal-overlay.show');
            if (activeModal) {
                e.preventDefault();
                activeModal.classList.remove('show');
                setTimeout(() => activeModal.style.display = 'none', 200);
                return false;
            }
        }

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì´ ì‹œê°„ ì €ì¥
        window.addEventListener('beforeunload', () => {
            appSettings.totalUsageTime += appSettings.currentSessionTime;
            appSettings.currentSessionTime = 0;
            saveSettings();
        });

        // ì•± ì´ˆê¸°í™” ì‹¤í–‰
        initApp();
    </script>
</body>
</html>
